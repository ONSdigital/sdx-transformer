title: "Build Spec for BRES"
survey_id: "221"
target: "SDS"
period_format: "YYYYM"
item_list_path: "items.local-units"
template:
    schema_version: "v1"
    identifier: "#ruref"
    vat:
        registration_number: "$VAT_REG"
        subsidiary_identifier: "$VAT_SUB"
    employer_paye:
        tax_office_number: "$PAYE_OFFICE"
        reference: "$PAYE_REF"
    "address": [
        "#ruaddr1", "#ruaddr2", "#ruaddr3", "#ruaddr4", "#ruaddr5", "#rupostcode"
    ]
    items:
        local-units:
            -   identifier: "#luref"
                name: "$CONCAT_NAME"
                trading_name: "$CONCAT_TRADING_NAME"
                business_description: "#bus_desc"
                "address": [
                    "$LUNAME_ONE", "$LUNAME_TWO", "$LUNAME_THREE", "$LUNAME_FOUR", "$LUNAME_FIVE", "$LUPOSTCODE"
                ]
transforms:
    "CONCAT_NAME":
        name: "CONCAT"
        args:
            value: "#luname1"
            values: ["#luname2", "#luname3"]
            seperator: " "
    "CONCAT_TRADING_NAME":
        name: "CONCAT"
        args:
            value: "#tradstyle1"
            values: [ "#tradstyle2", "#tradstyle3" ]
            seperator: " "
    "VAT_REG":
        name: "CARVE"
        args:
            value: "#vatref"
            end_index: 9
    "VAT_SUB":
        name: "CARVE"
        args:
            value: "#vatref"
            start_index: 9
        "post": "$FILTER_BLANK_VAT_SUB"

    "FILTER_BLANK_VAT_SUB":
        name: "CONTAINS"
        "args":
            "match_str": "000"
            "on_true": null
            "on_false": "&value"

    "PAYE_OFFICE":
        name: "CARVE"
        args:
            value: "#payeref"
            end_index: 3
    "PAYE_REF":
        name: "CARVE"
        args:
            value: "#payeref"
            start_index: 3
    "LUNAME_ONE":
        name: "LUREF_CHECK_REPLACE"
        args:
            "value": "#luref"
            "on_true": "#luaddr1"
            "on_false": "#ruaddr1"
    "LUNAME_TWO":
        name: "LUREF_CHECK_REPLACE"
        args:
            "value": "#luref"
            "on_true": "#luaddr2"
            "on_false": "#ruaddr2"
    "LUNAME_THREE":
        name: "LUREF_CHECK_REPLACE"
        args:
            "value": "#luref"
            "on_true": "#luaddr3"
            "on_false": "#ruaddr3"
    "LUNAME_FOUR":
        name: "LUREF_CHECK_REPLACE"
        args:
            "value": "#luref"
            "on_true": "#luaddr4"
            "on_false": "#ruaddr4"
    "LUNAME_FIVE":
        name: "LUREF_CHECK_REPLACE"
        args:
            "value": "#luref"
            "on_true": "#luaddr5"
            "on_false": "#ruaddr5"
    "LUPOSTCODE":
        name: "LUREF_CHECK_REPLACE"
        args:
            "value": "#luref"
            "on_true": "#lupostcode"
            "on_false": "#rupostcode"